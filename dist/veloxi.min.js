(function(d,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(d=typeof globalThis<"u"?globalThis:d||self,g(d.Veloxi={}))})(this,function(d){"use strict";var At=Object.defineProperty;var Bt=(d,g,w)=>g in d?At(d,g,{enumerable:!0,configurable:!0,writable:!0,value:w}):d[g]=w;var n=(d,g,w)=>(Bt(d,typeof g!="symbol"?g+"":g,w),w);class g{constructor(t){n(this,"x");n(this,"y");n(this,"target");this.x=t.x,this.y=t.y,this.target=t.target}}class w extends g{}class P extends g{}class y extends g{}class V extends g{}class A{constructor(t){n(this,"pluginId");n(this,"pluginName");n(this,"viewName");n(this,"dataName");n(this,"dataValue");this.event=t,this.pluginId=t.pluginId,this.pluginName=t.pluginName,this.viewName=t.viewName,this.dataName=t.dataName,this.dataValue=t.dataValue}}function G(o){return o.replace(/(?:^\w|[A-Z]|\b\w)/g,function(t,e){return e===0?t.toLowerCase():t.toUpperCase()}).replace(/\s+/g,"").replace(/-+/g,"")}function Z(o){return o.split("").map((t,e)=>t.toUpperCase()===t?`${e!==0?"-":""}${t.toLowerCase()}`:t).join("")}class B{constructor(t){n(this,"node");this.node=t.node}}class D{constructor(t){n(this,"node");this.node=t.node}}class J{constructor(t){n(this,"_eventBus");n(this,"_observer");this._eventBus=t,this._observer=new MutationObserver(this._handler.bind(this)),this._observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0})}_handler(t){t.forEach(e=>{e.addedNodes.forEach(r=>{if(!(r instanceof HTMLElement)||r.dataset.velViewId||r.parentElement&&typeof r.parentElement.dataset.velAdded<"u")return;this._eventBus.emitEvent(B,{node:r});const a=r.querySelectorAll("[data-vel-plugin]");a.length&&a.forEach(h=>{this._eventBus.emitEvent(B,{node:h})})}),e.removedNodes.forEach(r=>{if(!(r instanceof HTMLElement)||typeof r.dataset.velProcessing<"u")return;const a=r.querySelectorAll("[data-vel-plugin]");a.length&&a.forEach(h=>{this._eventBus.emitEvent(D,{node:h})}),this._eventBus.emitEvent(D,{node:r})});const i=e.attributeName;if(i&&/data-vel-data-.+/gi.test(i)){const r=e.target,a=r.dataset.velPluginId||"",h=r.dataset.velPlugin||"",c=r.dataset.velView||"",l=r.getAttribute(i);if(l&&l!==e.oldValue){const p=G(i.replace("data-vel-data-",""));this._eventBus.emitEvent(A,{pluginId:a,pluginName:h,viewName:c,dataName:p,dataValue:l})}}})}}class K{execute(t){this.call(t)}}class Q extends K{constructor(e){super();n(this,"_handler");this._handler=e}call(e){this._handler(e)}}class N{constructor(){n(this,"_listeners",new Map)}subscribeToEvent(t,e){let i=this._listeners.get(t);i||(i=[],this._listeners.set(t,i)),i.push(new Q(e))}emitEvent(t,e){const i=this._listeners.get(t);i&&i.forEach(s=>{s.execute(e)})}reset(){this._listeners.clear()}}let tt=0;function M(){return tt+++""}class et{constructor(t,e,i,s){n(this,"id");n(this,"parentPlugin");n(this,"_registry");n(this,"_eventBus");n(this,"_config");n(this,"_internalEventBus");n(this,"_setupCallback");n(this,"_updateCallback");n(this,"_renderCallback");n(this,"_subscribeToEventsCallback");n(this,"_onViewAddedCallback");n(this,"_onViewRemovedCallback");n(this,"_onDataChangedCallback");this.id=t,this._registry=e,this._eventBus=i,this._config=s,this._internalEventBus=new N}get internalEventBus(){return this._internalEventBus}setup(t){this._setupCallback=t}callSetup(){var t;(t=this._setupCallback)==null||t.call(this)}update(t){this._updateCallback=t}callUpdate(t,e){var i;(i=this._updateCallback)==null||i.call(this,t,e)}render(t){this._renderCallback=t}callRender(){var t;(t=this._renderCallback)==null||t.call(this)}subscribeToEvents(t){this._subscribeToEventsCallback=t}callSubscribeToEvents(t){var e;(e=this._subscribeToEventsCallback)==null||e.call(this,t)}onViewAdded(t){this._onViewAddedCallback=t}callOnViewAdded(t){var e;(e=this._onViewAddedCallback)==null||e.call(this,t)}onViewRemoved(t){this._onViewRemovedCallback=t}callOnViewRemoved(t){var e;(e=this._onViewRemovedCallback)==null||e.call(this,t)}onDataChanged(t){this._onDataChangedCallback=t}callOnDataChanged(t){var e;(e=this._onDataChangedCallback)==null||e.call(this,t)}usePlugin(t,e={}){const i=this._registry.createPlugin(t,this._eventBus,e);return i.setParentPluginContext(this),i}getViews(t){return t?this._registry.getViewsForPluginByName(this,t):this._registry.getViewsForPlugin(this)}getView(t){var e;return(e=this._registry.getViewsForPluginByName(this,t))==null?void 0:e[0]}getViewById(t){return this._registry.getViews().find(e=>e.id===t)}getConfig(){return this._config}getEventBus(){return this._eventBus}emit(t,e){this._internalEventBus.emitEvent(t,e)}}class it{constructor(t,e){n(this,"id");n(this,"parentContext");n(this,"_registry");n(this,"_internalEventBus");n(this,"_context");this._registry=e,this._internalEventBus=t.internalEventBus,this.id=t.id,this._context=t}setParentPluginContext(t){this.parentContext=t}addView(t,{notify:e}={notify:!1}){this._registry.addViewToPlugin(t,this),t.setPluginId(this.id),e&&this._context.callOnViewAdded(t)}on(t,e){this._internalEventBus.subscribeToEvent(t,e)}}class b{constructor(t,e,i,s){n(this,"id");n(this,"pluginName");n(this,"_context");n(this,"_public");n(this,"_initialized",!1);this.id=t,this._context=e,this._context.setup(this.setup),this._context.render(this.render),this._context.update(this.update),this._context.subscribeToEvents(this.subscribeToEvents),this._public=i,this.pluginName=s}get parentPluginId(){var t;return(t=this._public.parentContext)==null?void 0:t.id}get publicPlugin(){return this._public}getEventBus(){return this._context.getEventBus()}usePlugin(t,e={}){return this._context.usePlugin(t,e)}render(){var t;(t=this._context)==null||t.callRender()}renderViews(){this._context.getViews().forEach(t=>t.render())}init(){this._initialized||(this.setup(),this._initialized=!0)}setup(){var t;(t=this._context)==null||t.callSetup()}update(t,e){var i;(i=this._context)==null||i.callUpdate(t,e)}subscribeToEvents(t){var e;(e=this._context)==null||e.callSubscribeToEvents(t)}onViewAdded(t){}onViewRemoved(t){}onDataChanged(t){}notifyAboutViewRemoved(t){this._context.callOnViewRemoved(t)}notifyAboutDataChanged(t){this._context.callOnDataChanged(t)}getViews(t){return this._context.getViews(t)}getView(t){return this._context.getView(t)}getViewById(t){return this._context.getViewById(t)}getConfig(){return this._context.getConfig()}addView(t,e={notify:!0}){this._public.addView(t,{notify:e.notify})}emit(t,e){this._context.emit(t,e)}on(t,e){this._public.on(t,e)}}function st(o){return typeof o=="function"&&o.name===""?!1:o.prototype.constructor.toString().indexOf("class ")===0}function O(o,t,e,i){const s=M(),r=new et(s,t,e,i),a=new it(r,t),h=o.pluginName?o.pluginName:o.name;if(st(o)){const l=new o(s,r,a,h);return r.onViewAdded(l.onViewAdded.bind(l)),r.onViewRemoved(l.onViewRemoved.bind(l)),r.onDataChanged(l.onDataChanged.bind(l)),l}const c=new b(s,r,a,h);return o(r,i),c}class u{constructor(t,e){n(this,"x");n(this,"y");this.x=t,this.y=e}get magnitudeSquared(){return this.x*this.x+this.y*this.y}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get unitVector(){const t=new u(0,0),e=this.magnitude;return e!==0&&(t.x=this.x/e,t.y=this.y/e),t}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}scale(t){this.x*=t,this.y*=t}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}clone(){return new u(this.x,this.y)}static scale(t,e){return new u(t.x*e,t.y*e)}static sub(t,e){return new u(t.x-e.x,t.y-e.y)}static add(t,e){return new u(t.x+e.x,t.y+e.y)}}function L(o){const t=nt(o),e=rt(o);return{viewportOffset:{left:Math.round(t.left),top:Math.round(t.top),right:Math.round(t.right),bottom:Math.round(t.bottom)},pageOffset:{top:e.top,left:e.left},size:{width:o.offsetWidth,height:o.offsetHeight}}}function nt(o){const t=o.getBoundingClientRect();return{left:t.left,top:t.top,right:t.right,bottom:t.bottom,width:t.width,height:t.height}}function rt(o){let t=o,e=0,i=0;for(;t;)e+=t.offsetTop,i+=t.offsetLeft,t=t.offsetParent;return{top:e,left:i}}const x=.01,j={speed:15};class z{constructor(t){n(this,"_config");this._config=t}}class at extends z{update({animatorProp:t,current:e,target:i,dt:s}){const r=u.sub(i,e),a=u.scale(r,this._config.speed);let h=u.add(e,u.scale(a,s));return this._shouldFinish(i,e,a)&&(h=i,t.callCompleteCallback()),t.callUpdateCallback(),h}_shouldFinish(t,e,i){return u.sub(t,e).magnitude<x&&i.magnitude<x}}class ot extends z{update({animatorProp:t,current:e,target:i,dt:s}){const a=(i-e)*this._config.speed;let h=e+a*s;return this._shouldFinish(i,e,a)&&(h=i,t.callCompleteCallback()),t.callUpdateCallback(),h}_shouldFinish(t,e,i){return Math.abs(t-e)<x&&Math.abs(i)<x}}class F{constructor(){n(this,"_config",{})}update(t){return t.target}}const $={stiffness:.5,damping:.75,speed:10},E=.01;class X{constructor(t){n(this,"_config");this._config=t}}class ut extends X{constructor(){super(...arguments);n(this,"_velocity",new u(0,0))}update({animatorProp:e,current:i,target:s,dt:r}){const a=u.scale(u.scale(u.sub(i,s),-1),this._config.stiffness);this._velocity=u.add(this._velocity,a),this._velocity=u.scale(this._velocity,this._config.damping);let h=u.add(i,u.scale(this._velocity,r*this._config.speed));return this._shouldFinish(s,i)&&(h=s,e.callCompleteCallback()),h}_shouldFinish(e,i){return u.sub(e,i).magnitude<E&&this._velocity.magnitude<E}}class ht extends X{constructor(){super(...arguments);n(this,"_velocity",0)}update({animatorProp:e,current:i,target:s,dt:r}){const a=-(i-s)*this._config.stiffness;this._velocity+=a,this._velocity*=this._config.damping;let h=i+this._velocity*r*this._config.speed;return this._shouldFinish(s,i)&&(h=s,e.callCompleteCallback()),h}_shouldFinish(e,i){return Math.abs(e-i)<E&&Math.abs(this._velocity)<E}}function lt(o){return o}const Y={duration:500,ease:lt};class U{constructor(t){n(this,"_config");n(this,"_startTime");this._config=t}reset(){this._startTime=void 0}}class ct extends U{update({animatorProp:t,initial:e,target:i,ts:s}){this._startTime||(this._startTime=s);const r=Math.min(1,(s-this._startTime)/this._config.duration);return r>=1&&t.callCompleteCallback(),u.add(e,u.scale(u.sub(i,e),this._config.ease(r)))}}class dt extends U{update({animatorProp:t,initial:e,target:i,ts:s}){this._startTime||(this._startTime=s);const r=Math.min(1,(s-this._startTime)/this._config.duration);return r>=1&&t.callCompleteCallback(),e+(i-e)*this._config.ease(r)}}class q{createAnimatorByName(t,e){switch(t){case"instant":return this.createInstantAnimator();case"dynamic":return this.createDynamicAnimator(e);case"tween":return this.createTweenAnimator(e);case"spring":return this.createSpringAnimator(e)}return this.createInstantAnimator()}}class k extends q{createInstantAnimator(){return new F}createTweenAnimator(t){return new ct({...Y,...t})}createDynamicAnimator(t){return new at({...j,...t})}createSpringAnimator(t){return new ut({...$,...t})}}class gt extends q{createInstantAnimator(){return new F}createDynamicAnimator(t){return new ot({...j,...t})}createTweenAnimator(t){return new dt({...Y,...t})}createSpringAnimator(t){return new ht({...$,...t})}}function _t(o,t){const e=o.map(t),i=Math.min(...e),s=e.indexOf(i);return o[s]}function H(o,t,e){return Math.min(Math.max(o,t),e)}function pt(o,t,e){return o+(t-o)*e}const wt=Object.freeze(Object.defineProperty({__proto__:null,clamp:H,minBy:_t,valueAtPercentage:pt},Symbol.toStringTag,{value:"Module"}));function C(o){return structuredClone(o)}class ft{constructor(t){n(this,"_viewProp");n(this,"_completeCallback");n(this,"_updateCallback");this._viewProp=t}set(t,e){this._viewProp.setAnimator(t,e)}onComplete(t){this._completeCallback=t}callCompleteCallback(){var t;(t=this._completeCallback)==null||t.call(this)}onUpdate(t){this._updateCallback=t}callUpdateCallback(){var t;(t=this._updateCallback)==null||t.call(this)}}class T{constructor(t,e,i){n(this,"_animatorProp");n(this,"_animator");n(this,"_initialValue");n(this,"_targetValue");n(this,"_currentValue");n(this,"_hasChanged");n(this,"_parentView");n(this,"_animatorFactory");this._animatorProp=new ft(this),this._animatorFactory=t,this._initialValue=C(e),this._targetValue=C(e),this._currentValue=C(e),this._hasChanged=!1,this._parentView=i,this._animator=this._animatorFactory.createInstantAnimator()}get animator(){return this._animatorProp}get _rect(){return this._parentView.rect}setAnimator(t,e){this._animator=this._animatorFactory.createAnimatorByName(t,e)}_setTarget(t,e=!0){var i,s;this._initialValue=C(this._currentValue),this._targetValue=t,e?(s=(i=this._animator).reset)==null||s.call(i):this._currentValue=t,this._hasChanged=!0}hasChanged(){return this._hasChanged}update(t,e){}}class mt extends T{get x(){return this._currentValue.x+this._rect.pageOffset.left}get y(){return this._currentValue.y+this._rect.pageOffset.top}get initialX(){return this._rect.pageOffset.left}get initialY(){return this._rect.pageOffset.top}progressTo(t){const e=typeof t.x>"u"?this.initialX:t.x,i=typeof t.y>"u"?this.initialY:t.y,s=new u(e,i),r=new u(this.initialX,this.initialY),a=new u(this.x,this.y),h=u.sub(s,r),c=u.sub(a,r);let l=0;return h.dot(c)>0&&(l=c.magnitude),H(l/h.magnitude,0,1)}set(t,e=!0){const s={...{x:this.x,y:this.y},...t};this._setTarget(new u(s.x-this._rect.pageOffset.left,s.y-this._rect.pageOffset.top),e)}reset(t=!0){this._setTarget(new u(0,0),t)}update(t,e){this._targetValue.x===this._currentValue.x&&this._targetValue.y===this._currentValue.y||(this._currentValue=this._animator.update({animatorProp:this._animatorProp,current:this._currentValue,target:this._targetValue,initial:this._initialValue,ts:t,dt:e}))}projectStyles(){return`translate3d(${this._currentValue.x}px, ${this._currentValue.y}px, 0)`}isTransform(){return!0}}class vt extends T{constructor(){super(...arguments);n(this,"_unit","deg")}get degrees(){return this._currentValue}setDegrees(e,i=!0){this._unit="deg",this._setTarget(e,i)}setRadians(e,i=!0){this._unit="rad",this._setTarget(e,i)}reset(e=!0){this._setTarget(0,e)}update(e,i){this._targetValue!==this._currentValue&&(this._currentValue=this._animator.update({animatorProp:this._animatorProp,current:this._currentValue,target:this._targetValue,initial:this._initialValue,ts:e,dt:i}))}projectStyles(){return`rotate(${this._currentValue}${this._unit})`}isTransform(){return!0}}class Pt extends T{get x(){return this._currentValue.x}get y(){return this._currentValue.y}set(t,e=!0){const s={...{x:this._currentValue.x,y:this._currentValue.y},...t};this._setTarget(new u(s.x,s.y),e)}setWithSize(t,e=!0){let i=this._currentValue.x,s=this._currentValue.y;t.width&&(i=t.width/this._rect.size.width),t.height&&(s=t.height/this._rect.size.height),!t.width&&t.height&&(i=s),!t.height&&t.width&&(s=i);const r={x:i,y:s};this._setTarget(new u(r.x,r.y),e)}reset(t=!0){this._setTarget(new u(1,1),t)}update(t,e){this._targetValue.x===this._currentValue.x&&this._targetValue.y===this._currentValue.y||(this._currentValue=this._animator.update({animatorProp:this._animatorProp,current:this._currentValue,target:this._targetValue,initial:this._initialValue,ts:t,dt:e}))}projectStyles(){return`scale3d(${this._currentValue.x}, ${this._currentValue.y}, 1)`}isTransform(){return!0}}class yt extends T{get width(){return this._currentValue.x}get height(){return this._currentValue.y}get initialWidth(){return this._rect.size.width}get initialHeight(){return this._rect.size.height}set(t,e=!0){const s={...{width:this._currentValue.x,height:this._currentValue.y},...t};this._setTarget(new u(s.width,s.height),e)}reset(t=!0){this._setTarget(new u(this.initialWidth,this.initialHeight),t)}update(t,e){this._targetValue.x===this._currentValue.x&&this._targetValue.y===this._currentValue.y||(this._currentValue=this._animator.update({animatorProp:this._animatorProp,current:this._currentValue,target:this._targetValue,initial:this._initialValue,ts:t,dt:e}))}projectStyles(){return`width: ${this.width}px; height: ${this.height}px;`}isTransform(){return!1}}class Vt{constructor(t){n(this,"_props",new Map);this._props.set("position",new mt(new k,new u(0,0),t)),this._props.set("scale",new Pt(new k,new u(1,1),t)),this._props.set("rotation",new vt(new gt,0,t)),this._props.set("size",new yt(new k,new u(t.rect.size.width,t.rect.size.height),t))}allProps(){return Array.from(this._props.values())}get position(){return this._props.get("position")}get scale(){return this._props.get("scale")}get rotation(){return this._props.get("rotation")}get size(){return this._props.get("size")}}class W{constructor(t,e){n(this,"id");n(this,"name");n(this,"element");n(this,"styles",{});n(this,"_viewProps");n(this,"_rect");this.id=M(),this.name=e,this.element=t,this._rect=L(this.element),this._viewProps=new Vt(this),this.element.dataset.velViewId=this.id}get position(){return this._viewProps.position}get scale(){return this._viewProps.scale}get rotation(){return this._viewProps.rotation}get size(){return this._viewProps.size}get data(){const t=this.element.dataset;return Object.keys(t).filter(s=>s.includes("velData")).map(s=>s.replace("velData","")).map(s=>`${s[0].toLowerCase()}${s.slice(1)}`).reduce((s,r)=>{const a=t[`velData${r[0].toUpperCase()}${r.slice(1)}`];return!s[r]&&a&&(s[r]=a),s},{})}setPluginId(t){this.element.dataset.velPluginId=t}hasElement(t){return this.element.contains(t)}getScroll(){let t=this.element,e=0,i=0;for(;t;)e+=t.scrollTop,i+=t.scrollLeft,t=t.offsetParent;return i+=window.scrollX,e+=window.scrollY,{y:e,x:i}}intersects(t,e){const i=this.getScroll(),s={x:this.position.x-i.x,y:this.position.y-i.y};return t>=s.x&&t<=s.x+this.size.width&&e>=s.y&&e<=s.y+this.size.height}overlapsWith(t){return this.position.x<t.position.x+t.size.width&&this.position.x+this.size.width>t.position.x&&this.position.y<t.position.y+t.size.height&&this.position.y+this.size.height>t.position.y}distanceTo(t){const e=new u(this.position.x,this.position.y),i=new u(t.position.x,t.position.y);return u.sub(i,e).magnitude}read(){this._rect=L(this.element)}get rect(){return this._rect}update(t,e){this._viewProps.allProps().forEach(i=>i.update(t,e))}render(){let t="";const e=this._viewProps.allProps(),i=e.filter(a=>a.isTransform()),s=e.filter(a=>!a.isTransform()),r=i.reduce((a,h,c)=>(a+=h.projectStyles(),c===i.length-1&&(a+=";"),a),"transform: ");t+=r,s.forEach(a=>{a.hasChanged()&&(t+=a.projectStyles())}),t+=this._getUserStyles(),this.element.style.cssText=t}_getUserStyles(){return Object.keys(this.styles).reduce((t,e)=>e?t+`${Z(e)}: ${this.styles[e]};`:t,"")}markAsAdded(){delete this.element.dataset.velProcessing}}class bt{constructor(){n(this,"_plugins",[]);n(this,"_views",[]);n(this,"_viewsPerPlugin",new Map);n(this,"_viewsToBeCreated",[]);n(this,"_viewsToBeRemoved",[]);n(this,"_viewsCreatedInPreviousFrame",[])}update(){this._viewsCreatedInPreviousFrame.forEach(i=>{i.markAsAdded()}),this._viewsCreatedInPreviousFrame=[];const t=this._viewsToBeCreated.filter(i=>{const s=i.dataset.velPlugin;return s?this.getPluginByName(s):!1});t.length&&(t.forEach(i=>{const s=i.dataset.velPlugin,r=i.dataset.velView;if(!r||!s)return;const a=this.createView(i,r),h=this.getPluginByName(s);h&&h.addView(a)}),this._viewsToBeCreated=[]);const e=this._viewsToBeRemoved.filter(i=>i.dataset.velViewId);e.length&&(e.forEach(i=>{const s=i.dataset.velViewId;s&&this._removeViewById(s)}),this._viewsToBeRemoved=[])}_removeViewById(t){this._plugins.forEach(e=>{const i=this._viewsPerPlugin.get(e.id);if(!i)return;const s=i.indexOf(t),r=this._getViewById(t);s!==-1&&r&&(i.splice(s,1),e.notifyAboutViewRemoved(r))}),this._views=this._views.filter(e=>e.id!==t)}_getViewById(t){return this._views.find(e=>e.id===t)}queueNodeToBeCreated(t){this._viewsToBeCreated.push(t)}queueNodeToBeRemoved(t){this._viewsToBeRemoved.push(t)}notifyPluginAboutDataChange(t){const e=this._plugins.filter(i=>i.id===t.pluginId);e&&e.forEach(i=>{i.notifyAboutDataChanged({dataName:t.dataName,dataValue:t.dataValue,viewName:t.viewName});const s=this._plugins.find(r=>r.id===i.parentPluginId);s&&s.notifyAboutDataChanged({dataName:t.dataName,dataValue:t.dataValue,viewName:t.viewName})})}getPlugins(){return this._plugins}getPluginByName(t){return this._plugins.find(e=>e.pluginName===t)}createPlugin(t,e,i={}){let s=[];if(t.scope){const h=document.querySelectorAll(`[data-vel-plugin=${t.name}][data-vel-view=${t.scope}]`);h?s=Array.from(h):s=[document.documentElement]}else s=[document.documentElement];const r=s.map(h=>{const c=O(t,this,e,i);this._plugins.push(c);let l=[];h!==document.documentElement&&l.push(h);const p=h.querySelectorAll(`[data-vel-plugin=${c.pluginName}]`);return l=[...l,...p],l.length&&l.forEach(_=>{const f=_.dataset.velView;if(!f)return;const m=this.createView(_,f);c.addView(m,{notify:!1})}),c});if(r&&r.length>0)return r[0].publicPlugin;const a=O(t,this,e,i);return console.log(`%c WARNING: The plugin "${a.pluginName}" is created but there are no elements using it on the page`,"background: #885500"),a.publicPlugin}getViews(){return this._views}createView(t,e){const i=new W(t,e);return this._views.push(i),this._viewsCreatedInPreviousFrame.push(i),i}addViewToPlugin(t,e){this._viewsPerPlugin.has(e.id)||this._viewsPerPlugin.set(e.id,[]);const i=this._viewsPerPlugin.get(e.id);i.includes(t.id)||i.push(t.id)}getViewsForPlugin(t){const e=this._viewsPerPlugin.get(t.id);return e?e.map(s=>this._views.find(r=>r.id===s)).filter(s=>!!s):[]}getViewsForPluginByName(t,e){return this.getViewsForPlugin(t).filter(i=>i.name===e)}}class S{constructor(){n(this,"_previousTime",0);n(this,"_registry");n(this,"_eventBus");this._registry=new bt,this._eventBus=new N,new J(this._eventBus)}static create(){return new S}addPlugin(t,e={}){this._registry.createPlugin(t,this._eventBus,e)}onPluginEvent(t,e,i){const s=this._registry.getPluginByName(t.name);s&&s.on(e,i)}run(){document.addEventListener("DOMContentLoaded",()=>{this._setup(),requestAnimationFrame(this._tick.bind(this))})}_setup(){this._listenToNativeEvents()}_listenToNativeEvents(){document.addEventListener("click",t=>{this._eventBus.emitEvent(w,{x:t.clientX,y:t.clientY,target:t.target})}),document.addEventListener("pointermove",t=>{this._eventBus.emitEvent(P,{x:t.clientX,y:t.clientY,target:t.target})}),document.addEventListener("pointerdown",t=>{this._eventBus.emitEvent(y,{x:t.clientX,y:t.clientY,target:t.target})}),document.addEventListener("pointerup",t=>{this._eventBus.emitEvent(V,{x:t.clientX,y:t.clientY,target:t.target})})}_tick(t){let e=(t-this._previousTime)/1e3;e>.016&&(e=1/60),this._previousTime=t,this._eventBus.reset(),this._subscribeToEvents(),this._read(),this._update(t,e),this._render(),requestAnimationFrame(this._tick.bind(this))}_subscribeToEvents(){this._eventBus.subscribeToEvent(B,this._onNodeAdded.bind(this)),this._eventBus.subscribeToEvent(D,this._onNodeRemoved.bind(this)),this._eventBus.subscribeToEvent(A,this._onDataChanged.bind(this)),this._registry.getPlugins().forEach(t=>{t.subscribeToEvents(this._eventBus)})}_onNodeAdded({node:t}){this._registry.queueNodeToBeCreated(t)}_onNodeRemoved({node:t}){this._registry.queueNodeToBeRemoved(t)}_onDataChanged(t){this._registry.notifyPluginAboutDataChange(t)}_read(){this._registry.getViews().forEach(t=>{t.read()})}_update(t,e){this._registry.update(),this._registry.getPlugins().slice().reverse().forEach(i=>{i.init()}),this._registry.getPlugins().forEach(i=>{i.update(t,e)}),this._registry.getViews().forEach(i=>{i.update(t,e)})}_render(){this._registry.getPlugins().forEach(t=>{t.render()}),this._registry.getViews().forEach(t=>{t.render()})}}class I{constructor(t){n(this,"view");n(this,"previousX");n(this,"previousY");n(this,"x");n(this,"y");n(this,"isDragging");n(this,"target");n(this,"directions",[]);n(this,"width");n(this,"height");this.props=t,this.previousX=t.previousX,this.previousY=t.previousY,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.view=t.view,this.isDragging=t.isDragging,this.target=t.target,this.directions=t.directions}}class xt extends b{constructor(){super(...arguments);n(this,"_pointerX",0);n(this,"_pointerY",0);n(this,"_initialPointer",new u(0,0));n(this,"_initialPointerPerView",new Map);n(this,"_pointerDownPerView",new Map);n(this,"_targetPerView",new Map);n(this,"_viewPointerPositionLog",new Map)}setup(){document.addEventListener("selectstart",this.onSelect.bind(this))}onSelect(e){this._isDragging&&e.preventDefault()}get _isDragging(){return Array.from(this._pointerDownPerView.values()).some(e=>!!e)}subscribeToEvents(e){e.subscribeToEvent(y,({x:i,y:s,target:r})=>{this._initialPointer=new u(i,s),this.getViews().forEach(a=>{this._pointerDownPerView.set(a.id,a.intersects(i,s)),this._targetPerView.set(a.id,r);const h=new u(i-a.position.x,s-a.position.y);this._pointerX=i,this._pointerY=s,this._initialPointerPerView.set(a.id,h)})}),e.subscribeToEvent(V,()=>{this.getViews().forEach(i=>{this._pointerDownPerView.get(i.id)&&this._initialPointerPerView.get(i.id)&&(this._pointerDownPerView.set(i.id,!1),this._emitEvent(i,[])),this._viewPointerPositionLog.clear()})}),e.subscribeToEvent(P,({x:i,y:s})=>{this._pointerX=i,this._pointerY=s,this.getViews().forEach(r=>{if(this._pointerDownPerView.get(r.id)&&this._initialPointerPerView.get(r.id)){this._viewPointerPositionLog.has(r.id)||this._viewPointerPositionLog.set(r.id,[]);const a=new u(i,s),h=this._viewPointerPositionLog.get(r.id);h&&h.push(new u(i,s));const c=h&&h.length>=2?h[h.length-2]:a.clone(),l=this._calculateDirections(c,a);this._emitEvent(r,l)}})})}_emitEvent(e,i){const s=this._viewPointerPositionLog.get(e.id),r=s&&s.length>=2?s[s.length-2]:null,a=this._pointerX-this._initialPointerPerView.get(e.id).x,h=this._pointerY-this._initialPointerPerView.get(e.id).y,c=r?r.x-this._initialPointerPerView.get(e.id).x:a,l=r?r.y-this._initialPointerPerView.get(e.id).y:h,p=this._pointerY-this._initialPointer.y,_=this._pointerX-this._initialPointer.x,f=this._targetPerView.get(e.id);if(!f||!e.hasElement(f))return;const m=this._pointerDownPerView.get(e.id)===!0,v={view:e,target:f,previousX:c,previousY:l,x:a,y:h,width:_,height:p,isDragging:m,directions:i};this.getEventBus().emitEvent(I,v),this.emit(I,v)}_calculateDirections(e,i){const s={up:u.sub(new u(e.x,e.y-1),e),down:u.sub(new u(e.x,e.y+1),e),left:u.sub(new u(e.x-1,e.y),e),right:u.sub(new u(e.x+1,e.y),e)},r=u.sub(i,e).unitVector;return[{direction:"up",projection:r.dot(s.up)},{direction:"down",projection:r.dot(s.down)},{direction:"left",projection:r.dot(s.left)},{direction:"right",projection:r.dot(s.right)}].filter(c=>c.projection>0).map(c=>c.direction)}}class R{constructor(t){n(this,"view");n(this,"direction");this.props=t,this.view=t.view,this.direction=t.direction}}class Et extends b{constructor(){super(...arguments);n(this,"_viewIsPointerDownMap",new Map);n(this,"_viewPointerPositionLog",new Map);n(this,"_targetPerView",new Map)}subscribeToEvents(e){e.subscribeToEvent(y,({x:i,y:s,target:r})=>{this.getViews().forEach(a=>{this._targetPerView.set(a.id,r),a.intersects(i,s)&&this._viewIsPointerDownMap.set(a.id,!0)})}),e.subscribeToEvent(P,({x:i,y:s})=>{this.getViews().forEach(r=>{if(!this._viewIsPointerDownMap.get(r.id))return;this._viewPointerPositionLog.has(r.id)||this._viewPointerPositionLog.set(r.id,[]),this._viewPointerPositionLog.get(r.id).push(new u(i,s))})}),e.subscribeToEvent(V,({x:i,y:s})=>{this.getViews().forEach(a=>{if(!this._viewIsPointerDownMap.get(a.id)||!this._viewPointerPositionLog.has(a.id))return;const h=new u(i,s),c=this._viewPointerPositionLog.get(a.id),l=c[c.length-2]||h.clone(),p=this._targetPerView.get(a.id),_=r(l,h);p&&a.hasElement(p)&&_.hasSwiped&&(this.getEventBus().emitEvent(R,{view:a,direction:_.direction}),this.emit(R,{view:a,direction:_.direction})),this._viewPointerPositionLog.set(a.id,[]),this._viewIsPointerDownMap.set(a.id,!1)});function r(a,h){const c={up:u.sub(new u(a.x,a.y-1),a),down:u.sub(new u(a.x,a.y+1),a),left:u.sub(new u(a.x-1,a.y),a),right:u.sub(new u(a.x+1,a.y),a)},l=u.sub(h,a).unitVector,p=["up","down","left","right"],_=[l.dot(c.up),l.dot(c.down),l.dot(c.left),l.dot(c.right)],f=Math.max(..._),m=_.indexOf(f),v=p[m],Tt=u.sub(h,a).magnitude;return{hasSwiped:l.dot(c[v])*Tt>30,direction:v}}})}}const Ct=Object.freeze(Object.defineProperty({__proto__:null,PointerClickEvent:w,PointerDownEvent:y,PointerMoveEvent:P,PointerUpEvent:V},Symbol.toStringTag,{value:"Module"}));d.App=S,d.DataChangedEvent=A,d.DragEvent=I,d.DragEventPlugin=xt,d.EventBus=N,d.Events=Ct,d.Plugin=b,d.SwipeEvent=R,d.SwipeEventPlugin=Et,d.Utils=wt,d.View=W,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
